<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, user-scalable=no" name="viewport"/>
  <link href="taskFrom2To6.css" rel="stylesheet" type="text/css"/>
  <title>Title</title>
</head>
<body>
<div id="tasks">
  <div class="tasks__wrapper">
    <form class="create-task-block">
      <input
        class="create-task-block__input default-text-input"
        name="taskName"
        placeholder="–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É"
        type="text"
        value="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —É—Ä–æ–∫ –ø–æ JavaScript"
      >
      <button
        class="create-task-block__button default-button"
        type="submit"
      >
        –°–æ–∑–¥–∞—Ç—å
      </button>
    </form>
    <div class="tasks-list"></div>
  </div>
</div>

<!-- Task 5Ô∏è‚É£ -->
<div class="modal-overlay modal-overlay_hidden">
  <div class="delete-modal">
    <h3 class="delete-modal__question">
      –í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?
    </h3>
    <div class="delete-modal__buttons">
      <button class="delete-modal__button delete-modal__cancel-button">
        –û—Ç–º–µ–Ω–∞
      </button>
      <button class="delete-modal__button delete-modal__confirm-button">
        –£–¥–∞–ª–∏—Ç—å
      </button>
    </div>
  </div>
</div>


<script>
  // Initial data
  const tasks = [
    {
      id: '1138465078061',
      completed: false,
      text: '–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–æ–≤—ã–π —É—Ä–æ–∫ –ø–æ JavaScript',
    },
    {
      id: '1138465078062',
      completed: false,
      text: '–í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç –ø–æ—Å–ª–µ —É—Ä–æ–∫–∞',
    },
    {
      id: '1138465078063',
      completed: false,
      text: '–í—ã–ø–æ–ª–Ω–∏—Ç—å –î–ó –ø–æ—Å–ª–µ —É—Ä–æ–∫–∞',
    },
  ]

  // Task 2Ô∏è‚É£ –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á –ø–æ —à–∞–±–ª–æ–Ω—É.
  // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∑–∞–¥–∞—á–∏, –∑–∞–ø–æ–ª–Ω—è–µ—Ç html —à–∞–±–ª–æ–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É
  const generateTaskHtmlFromTemplate = ({id, text} = {}) => {
    return `
     <div class="task-item" data-task-id="${id}">
       <div class="task-item__main-container">
         <div class="task-item__main-content">
           <form class="checkbox-form">
               <input class="checkbox-form__checkbox" type="checkbox" id="task-${id}">
               <label for="task-${id}"></label>
           </form>
           <span class="task-item__text">${text}</span>
         </div>
         <button class="task-item__delete-button default-button delete-button" data-delete-task-id="${id}">–£–¥–∞–ª–∏—Ç—å</button>
       </div>
     </div>`;
  }

  // –î–æ—Å—Ç–∞–µ–º –æ–±—ä–µ–∫—Ç —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á
  const taskList = document.querySelector(".tasks-list");
  const taskCreationForm = document.querySelector(".create-task-block");


  // üö© –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ "–ó–∞–¥–∞—á –Ω–µ—Ç" –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ø—É—Å—Ç

  const LIST_HAS_CHANGED = 'list-has-changed-event';
  // –°–ª—É—à–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–ø–∏—Å–∫–∞
  taskList.addEventListener(LIST_HAS_CHANGED, () => {
    if (tasks.length === 0) { // –µ—Å–ª–∏ –∑–∞–¥–∞—á –Ω–µ—Ç, —Ç–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "–ó–∞–¥–∞—á –Ω–µ—Ç"
      const tasksEmptyMessage = '<span class="task-list__empty">–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ø—É—Å—Ç :)</span>';
      taskList.insertAdjacentHTML("afterbegin", tasksEmptyMessage);
    }
    else { // –ò–Ω–∞—á–µ —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –µ—Å–ª–∏ –±—ã–ª–∞
      taskList.querySelector('.task-list__empty')?.remove();
    }

    // –ï—Å–ª–∏ –±—ã–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏—Ö —É–±–∏—Ä–∞–µ–º, –ø–æ—Å–∫–æ–ª—å–∫—É –ª–∏—Å—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è
    taskCreationForm.querySelector('.error-message-block')?.remove();
  })

  taskList.dispatchEvent(new CustomEvent(LIST_HAS_CHANGED));

  tasks.forEach((task) => {
    const taskHtml = generateTaskHtmlFromTemplate({
      id: task.id,
      text: task.text
    });
    taskList.insertAdjacentHTML("beforeend", taskHtml);
  });


  // Task 3Ô∏è‚É£ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á
  // –ü–æ —Ç–µ–∫—Å—Ç—É —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –≤ —Å–ø–∏—Å–∫–µ –∑–∞–¥–∞—á –∏ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
  const addTaskToListAndPage = (taskText) => {
    const newTask = {
      id: Date.now(),
      text: taskText,
      completed: false,
    }
    tasks.push(newTask);
    const newTaskHtml = generateTaskHtmlFromTemplate(newTask);
    taskList.insertAdjacentHTML("beforeend", newTaskHtml);
  }


  taskCreationForm.addEventListener('submit', (event) => {
    event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const taskInput = taskCreationForm.querySelector(".create-task-block__input");
    const inputTaskText = taskInput.value.trim(); // –î–æ—Å—Ç–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –ø–æ–ª—è –≤–≤–æ–¥–∞ –∏ —É–¥–∞–ª—è–µ–º –≥—Ä–∞–Ω–∏—á–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã


    // TASK 4Ô∏è‚É£ –õ–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–∫–∏ –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞
    const error = taskCreationForm.querySelector(".error-message-block");
    if (error !== null) {
      error.remove()
    }

    // –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞ –±—ã–ª–∞ –ø—É—Å—Ç–∞—è, —Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
    if (inputTaskText === '') {
      const error = '<span class="error-message-block">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç—ã–º.</span>';
      taskCreationForm.insertAdjacentHTML("afterbegin", error);
    }
    // –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
    else if (tasks.find((task) => task.text === inputTaskText)) {
      const error = '<span class="error-message-block">–ó–∞–¥–∞—á–∞ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.</span>';
      taskCreationForm.insertAdjacentHTML("afterbegin", error);
    }
    else { // Task 3Ô∏è‚É£ –ï—Å–ª–∏ –Ω–µ –±—ã–ª–æ –æ—à–∏–±–æ–∫ –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É
      taskInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
      addTaskToListAndPage(inputTaskText); // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –≤ —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á

      taskList.dispatchEvent(new CustomEvent(LIST_HAS_CHANGED)); // –°–æ–∑–¥–∞–µ–º —Å–æ–±—ã—Ç–∏–µ "list-changed";
    }
  });

  // Task 5Ô∏è‚É£. –õ–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á
  const modal = document.querySelector(".modal-overlay");
  let clickedTaskElem;

  // Listener –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–£–¥–∞–ª–∏—Ç—å" —É –∑–∞–¥–∞—á–∏
  taskList.addEventListener('click', (event) => {
    // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É—Ç—ã–π —ç–ª–µ–º–µ–Ω—Ç —ç—Ç–æ –∫–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å"
    if (event.target.closest(".task-item__delete-button")) {
      modal.classList.remove("modal-overlay_hidden"); // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      clickedTaskElem = event.target.closest(".task-item"); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ–±—ä–µ–∫—Ç –∑–∞–¥–∞—á–∏
    }
  });

  // Listener –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–û—Ç–º–µ–Ω–∞" –∏ "–£–¥–∞–ª–∏—Ç—å" –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
  modal.addEventListener('click', (event) => {
    // –ï—Å–ª–∏ –±—ã–ª–∞ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞"
    if (event.target.closest(".delete-modal__cancel-button")) {
      modal.classList.add("modal-overlay_hidden"); // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    }
    // –ï—Å–ª–∏ –±—ã–ª–∞ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å"
    if (event.target.closest(".delete-modal__confirm-button")) {
      const clickedTaskId = clickedTaskElem.dataset.taskId; // –ü–æ–ª—É—á–∞–µ–º id –∑–∞–¥–∞—á–∏
      tasks.splice(tasks.findIndex(task => task.id === clickedTaskId), 1); // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –∑–∞–¥–∞—á–∏ –∏ —É–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
      clickedTaskElem.remove(); // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∑–∞–¥–∞—á–∏ –∏–∑ DOM
      modal.classList.add("modal-overlay_hidden"); // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ

      taskList.dispatchEvent(new CustomEvent(LIST_HAS_CHANGED)); // –°–æ–∑–¥–∞–µ–º —Å–æ–±—ã—Ç–∏–µ "list-changed";
    }
  });

  // Task 6Ô∏è‚É£ –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
  let isDarkTheme = false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞

  // Listener –¥–ª—è —Å–º–µ–Ω—ã —Ç–µ–º—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ TAB
  document.addEventListener('keydown', (event) => {
    if (event.key === 'Tab' && !isDarkTheme) {
      document.body.style.background = "#24292E";
      taskList.style.color = '#fff';
      const buttons = document.querySelectorAll("button");
      Array.from(buttons).forEach(button => button.style.border = '1px solid #fff');

      document.body.classList.add('theme-dark')
      isDarkTheme = !isDarkTheme;
    }
    else if (event.key === 'Tab' && isDarkTheme) {
      document.body.style.background = "initial";
      taskList.style.color = 'initial';
      const buttons = document.querySelectorAll("button");
      Array.from(buttons).forEach(button => button.style.border = 'none');

      document.body.classList.remove('theme-dark')
      isDarkTheme = !isDarkTheme;
    }
  });

</script>
</body>
</html>